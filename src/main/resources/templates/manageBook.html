<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>登録更新</title>
</head>

<style>
	h4,p,a{
		color:black;
		font-size: small;
	}
	.caption{
		font-size:x-small;
		margin-top:-10px;
		margin-left:10px;
	}
	.grid-container{
		display: grid;
		grid-template-columns: 150px 250px 1fr;
		gap: 20px;
		margin-right: 100px;
	}
	.grid-item1{
		margin-top:10px;
		justify-content: center;
		background-color: #fff;
	}
	.grid-item2{
		background-color: #fff;
	}
	.grid-item3{
		background-color: #fff;
	}
	.clmn{
		display:inline-block;
		margin-top:10px;
		margin-bottom:10px;
		margin-left:10px;
		width:110px
	}
	.form{
		margin-top:10px;
		margin-bottom:10px;
		margin-left:10px;
		margin-right:30px;
		width:200px
	}
	#submitBtn{
		color:white;
		border:none;
		margin-top:20px;
		margin-left:130px;
		width:75px;
		height:30px
	}
	.btn-enabled{
		background-color: black;
		cursor: pointer;
	}
	.btn-disabled{
		background-color: lightgray;
	}
	.book_img{
		display:flex;
		justify-content: center;
		align-items:center;
		width:112px;
		height:150px;
		font-size: small;
		color:black;
		background-color:none;
		border: dashed;
		border-width: 1px;
		cursor:pointer; 
	}
	.st-available{
		margin-top:10px;
		margin-bottom:10px;
		display:flex;
		justify-content: center;
		align-items:center;
		font-size: 12px;
		border-style: initial;
		border: 1px solid;
		width:55px;
		height:25px;
	}
	.st-borrowed{
		margin-top:10px;
		margin-bottom:10px;
		display:flex;
		justify-content: center;
		align-items:center;
		font-size: 12px;
		border-style: initial;
		color:white;
		background-color:black;
		width:55px;
		height:25px;
	}
</style>

<body>
	<h4 style="margin-left: 25px; margin-bottom:50px;">
		書籍管理システム@<span th:text="${username}"></span>
	</h4>	
	<a href="/bookList" style="margin-left: 25px">書籍一覧へ戻る</a>
	
	<div style="position:absolute; top:100px; left:250px">
			<h1>貸出管理</h1>
			<hr style="width:850px; margin-left:0px;">
			<p style="margin-bottom:50px">
				以下の書籍の貸出管理を行います。
			</p>
			<form class="grid-container" 
				th:method="put"
				th:action="@{/bookList/{id}/manage(id=${id})}"
				enctype="multipart/form-data"
				th:object="${book}"
			>
				<div class="grid-item1">
					<div style="display:flex; flex-flow:column">
						<!--画像がある場合の表示-->
						<img
							th:if="${base64Image != null}"
							th:src="'data:image/jpeg;base64,'+${base64Image}"
							id="preview"
							width="112"
						/>
						<!--画像がない場合の表示-->
						<label
							th:if="${base64Image == null}"
							id="imagePlaceholder"
							for="imageInput"
							class="book_img"
						>no image</label>
					</div>
				</div>
				
				<div class="grid-item2">
					<div style="display: flex;">
						<div th:if="${book.status == 1}" class="st-available">貸出可</div>
						<div th:if="${book.status == 0}" class="st-borrowed">貸出中</div>
					</div>
					<div style="display: flex;">
						<p style="width:250px" th:text="*{category}"></p>
					</div>
					<div style="display: flex;">
						<p style="width:250px" th:text="*{title}"></p>
					</div>
				</div>
				
				<div class="grid-item3">
					<!--貸出可-->
					<div th:if="${book.status == 1}">
						<p style="margin-left:10px; margin-bottom:60px">
							利用者の情報を入力してください。
						</p>
					</div>
					
					<!--貸出中-->
					<div th:if="${book.status == 0}">
						<p style="margin-left:10px; margin-bottom:60px">
							以下の利用者に貸出中です。
						</p>
					</div>						
					
					<!--貸出可-->
					<div th:if="${book.status == 1}">													
						<div style="display: flex;">
							<p class="clmn">氏名</p>
							<input class="form"
								type="text"
								id="username"
								name="username"
								th:value="*{username}"
							>
						</div>
						<div style="display: flex;">
							<p class="clmn">メール（任意）</p>
							<input class="form"
								type="text"
								id="address"
								name="address"
								th:value="*{address}"
							>
						</div>
					</div>
					
					<!--貸出中-->
					<div th:if="${book.status == 0}">													
						<div style="display: flex;">
							<p class="clmn">氏名</p>
							<p  class="clmn"
								type="text"
								id="username"
								name="username"
								th:text="*{username}"
							>
						</div>
						<div style="display: flex;">
							<p class="clmn">メール（任意）</p>
							<p  class="clmn"
								type="text"
								id="address"
								name="address"
								th:text="*{address}"
							>
						</div>
					</div>
										
					<div style="display: flex;">
						<p class="clmn">貸出日時</p>
						<!--貸出可-->
						<div  th:if="${book.status == 1}">
							<p class="clmn" th:text="${#strings.substring(now,0,16)}" style="margin-left:10px"></p>
							<p class="caption">※現在日時が登録されます</p>
						</div>
						<!--貸出中-->
						<div th:if="${book.status == 0}">
							<p class="clmn" th:text="*{#strings.substring(borrowDate,0,16)}" style="margin-left:10px"></p>
							<p class="caption">※貸出処理日時</p>
						</div>
					</div>
					<!--貸出可-->
					<button
						th:if="${book.status == 1}"
						type="submit"
						id="submitBtn"
						name="statusBt"
						value="borrow"
						class="btn-disabled"
						disabled>貸出</button>
					<!--貸出中-->
					<button
						th:if="${book.status == 0}"
						type="submit"
						id="submitBtn"
						name="statusBt"
						value="return"
						class="btn-enabled"
						enabled>返却</button>
					
				</div>
			</form>
		</div>
		
		<script>
			const usernameInput = document.getElementById('username');
			const submitBtn = document.getElementById('submitBtn');
			
			//ボタンの有効/無効を切替
			function checkInputs() {
				//利用者氏名の入力確認
				if(usernameInput.value.trim() !== ''){
					//入力を確認
					submitBtn.disabled = false;
					submitBtn.classList.remove('btn-disabled');
					submitBtn.classList.add('btn-enabled');
				} else {
					//空白を確認
					submitBtn.disabled = true;
					submitBtn.classList.remove('btn-enabled');
					submitBtn.classList.add('btn-disabled');
				}
			}
			
			//必須項目にリスナーを付与
			usernameInput.addEventListener('input', checkInputs);
			
			//アップロード画像を表示
			function previewImage(input){
				const file = input.files[0];
				if(file){
					const reader = new FileReader();
					reader.onload = function(e){
						const placeholder = document.getElementById('imagePlaceholder');
						const existing = document.getElementById('preview');
						if(existing){
							existing.src = e.target.result;
						} else if(placeholder){
							const img = document.createElement('img');
							img.id= 'preview';
							img.src = e.target.result;
							img.style.width = '100px';
							img.style.cursor= 'pointer';
							console.log(img.style.curser);
							img.onclick = () => document.getElementById('imageInput').click();			
							placeholder.replaceWith(img);
						}
					};
					reader.readAsDataURL(file);
				}
			}
		</script>
				
	<script src="/js/jquery-3.7.1.min"></script>
	<script src="/js/bootstrap.min.js"></script>
</body>
</html>